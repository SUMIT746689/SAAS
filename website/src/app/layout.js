import Head from 'next/head';
import './globals.css';
import Footer from '../layout/Footer';
import Header from '../layout/Header';
import LayoutWrapper from '../layout/LayoutWrapper';
import Nav from '../layout/Nav';
import prisma from '../../../src/lib/prisma_client';
import { headers } from 'next/headers';

export const metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app'
};


export default async function RootLayout({ children }) {

  try {
    const headersList = headers();
    const domain = headersList.get('referer')?.slice(0, -1)

    const school = await prisma.school.findFirstOrThrow({
      where: {
        domain: domain
      }
    })

    const school_info = await prisma.websiteUi.findFirstOrThrow({
      where: {
        school_id: school.id
      }
    })
    return (
      <html lang="en">
        <Head>
          <title>Home</title>
        </Head>
        <body>
          <LayoutWrapper>
            <Header header_image={school_info?.header_image} />
            <Nav serverhost={process.env.SERVER_HOST} />
            {children}
          </LayoutWrapper>
          <Footer />
        </body>
      </html>
    );


  } catch (err) {
    return (
      <div className=' grid place-content-center h-screen border-2 text-4xl'>

        <h1 className=" text-center font-bold">
          Your domain is not registered !!
        </h1>

      </div>
    )
  }

}
